<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>slider</title>
    <script src="react.development.js"></script> 
    <script src="react-dom.development.js"></script>
    <script src="babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const {useState,useCallback,useEffect,useRef} = React
      function MyApp() {
        let imgs =[
         {
           imgUrl:'a',
           link:'b',
         },
         {
           imgUrl:'c',
           link:'d',
         },
          {
            imgUrl:'e',
            link:'f',
          },
         
       ] 
        return  <div>
          <Carousel3 imgs={imgs} />
          </div>
      }

      //轮播图类组件
      class Carousel1 extends React.Component{
        constructor(props){
          super(props)
          this.state ={
            i:0,
          }
        }
        prev = ()=>{
          let i = this.state.i - 1
          if(i==-1){
            i = this.props.imgs.length - 1
          }else if(i==this.props.imgs.length){
            i = 0
          }
          this.setState({
            i: i
          })
        }
        next = ()=>{
          let i = this.state.i + 1
          if(i==-1){
            i = this.props.imgs.length - 1
          }else if(i==this.props.imgs.length){
            i = 0
          }
          this.setState({
            i: i
          })
        }
        render(){
          let i = i = this.state.i
          return (
            <div>
              <a href={this.props.imgs[i].link} target="_bllank">
                <img src={this.props.imgs[i].imgUrl} />  
              </a>
              <button onClick={ this.prev }>prev</button>
              <button onClick={ this.next }>next</button>
            </div>
          )
        }
      }


     

      //轮播图函数组件
      function Carousel2({imgs}){
        let [i,setI] = React.useState(0)
        let [hover,setHover] = React.useState(false)


        useEffect(()=>{
          if(hover) return
          let id = setInterval(()=>{
            next()
          },1000)
          return ()=>{
            clearInterval(id)
          }
        },[hover]) //当hover变化时重新执行

        let rootRef = useRef() //创建ref对象
        //函数组件没有字符串ref，只有对象ref和函数ref
        //函数组件也不能接ref属性 因为函数组件没有实例
        console.log('rootRef',rootRef.current)


        function prev(){
          setI( i => i == 0 ? imgs.length - 1 : i - 1)  
        }
        function next(){
          console.log('next',i)
          setI(i =>  i >= imgs.length - 1 ? 0 : i + 1)
        }
        function mouseEnter(){
          setHover(true)
        }
        function mouseLeave(){
          setHover(false)
        }
        return (
          <div ref={rootRef}>
            <img src={imgs[i].imgUrl}  onMouseEnter={mouseEnter} onMouseLeave={mouseLeave}/> 
            <button onClick={prev}>prev</button>
            <button onClick={next}>next</button>
          </div>
        )
      }

      //hover状态改变不会触发组件更新的写法 useRef记录hover状态
      function Carousel3({imgs}){
        let [i,setI] = React.useState(0)
        //let [hover,setHover] = React.useState(false)
        let timer = useRef() //使用ref记录hover状态

        useEffect(()=>{
          if([...document.querySelectorAll(':hover')].includes(rootRef.current)){
            mouseEnter()
            console.log('hovered')
          }else{
            mouseLeave()
          }
          return mouseLeave
        },[]) 


        function mouseEnter(){
          clearInterval(timer.current)
          
        }
        function mouseLeave(){
          timer.current = setInterval(()=>{
            next()
          },1000)
        }


        let rootRef = useRef() //创建ref对象
        //函数组件没有字符串ref，只有对象ref和函数ref
        //函数组件也不能接ref属性 因为函数组件没有实例


        function prev(){
          setI( i => i == 0 ? imgs.length - 1 : i - 1)  
        }
        function next(){
          console.log('next',i)
          setI(i =>  i >= imgs.length - 1 ? 0 : i + 1)
        }

        return (
          <div ref={rootRef}>
            <img src={imgs[i].imgUrl}  onMouseEnter={mouseEnter} onMouseLeave={mouseLeave}/> 
            <button onClick={prev}>prev</button>
            <button onClick={next}>next</button>
          </div>
        )
      }

      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<MyApp />);
    </script>
    

  </body>
</html>