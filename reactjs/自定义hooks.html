<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World</title>
    <script src="react.development.js"></script> 
    <script src="react-dom.development.js"></script>
    <script src="babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const {useState,useRef,useCallback,useEffect,useMemo,useImperativeHandle,useContext,useDebugValue} = React
      
      //自定义hooks
      function useTime(){
        let [time,setTime] = useState(() => new Date().toString())
        useEffect(()=>{
          let delay = 1000 - (new Date().getTime() % 1000)
          let id
          let id2 = setTimeout(()=>{
            setTime(new Date().toString())
            id = setInterval(()=>{
              setTime(new Date().toString())
            },1000)
          },delay)

          useDebugValue(time) //用于在React开发者工具中显示自定义hook的状态信息 方便调试

          return ()=>{
            clearInterval(id)
            clearTimeout(id2)
          }
        },[])
        return time
      }

      function usePointPos(){
        let [pointPos,setPointPos] = useState(()=> ({x:0,y:0}))
        useEffect(()=>{
          window.addEventListener('mousemove',(e)=>{
            setPointPos({x:e.clientX,y:e.clientY})
          })
          return ()=>{
            window.removeEventListener('mousemove',(e)=>{
              setPointPos({x:e.clientX,y:e.clientY})
            })
          }
         },[])
         return pointPos
      }

      function InputCopyVModel(){
        let [model,setModel] = useState('')
        let onChange = useCallback(function onChange(e){
          setModel(e.target.value)
        },[])
        return {
          value: model,
          onChange,
        }
      }

      function useRequest(fetcher){
        let [data,setData] = useState(null)
        let [error,setError] = useState(null)
        let [loading,setLoading] = useState(true)

        useEffect(()=>{
          fetcher().then(data=>{
            setData(data)
            setLoading(false)
          },error=>{
            setError(error)
            setLoading(false)
          })
        },[])

        return {
          data,
          error,
          loading,
        }
      }

      function useCountDown(dateString){
        let date = useMemo(()=>{
          return new Date(dateString).getTime()
        },[dateString])
        let now = new Date().getTime()
        let [countDown,setCountDown] = useState(((date - now)/1000) | 0)
        useEffect(()=>{
          let id = setInterval(()=>{
            let now = new Date().getTime()
            let diff = ((date - now)/1000) | 0
            setCountDown(diff)
          },1000)
          return ()=>{
            clearInterval(id)
          }
        },[date])
        return countDown
      }

      function useForceUpdate(){
        let [tick,setTick] = useState(0)
        return useCallback(function (){
          setTick(tick => tick + 1)
        },[])
      }

     function useCounter(init,{min,max}){
      let [count,setCount] = useState(()=>{
        if(init > max) return max
        else if(init < min) return min
        else return init
      })
      let inc = useCallback(function (){
        setCount(count => {
          let next = count + 1
          if(next > max) return max
          else return next
        })
      },[max])
      let dec = useCallback(function (){
        setCount(count => {
          let next = count - 1
          if(next < min) return min
          else return next
        })
      },[min])
      let reset = useCallback(function (){
        setCount(()=>{
          if(init > max) return max
          else if(init < min) return min
          else return init
        })
      },[init,min,max])
      let set = useCallback(function (newVal){
        setCount(()=>{
          if(newVal > max) return max
          else if(newVal < min) return min
          else return newVal
        })
      },[min,max])
      return {count,inc,dec,reset,set}
     }

     function useSet(initialArray){
      let [setState,setSetState] = useState(() => new Set(initialArray))
      let add = useCallback(function (item){
        setSetState(setState => {
          let newSet = new Set(setState)
          newSet.add(item)
          return newSet
        })
      },[])
      let remove = useCallback(function (item){
        setSetState(setState => {
          let newSet = new Set(setState)
          newSet.delete(item)
          return newSet
        })
      },[])
      return {add,remove}
     }

     function useInterval(callback,delay){
      let id = useRef()
      useEffect(()=>{
        id.current = setInterval(()=>{
          callback()
        },delay)
        return ()=>{
          clearInterval(id.current)
        }
      },[callback,delay])
      return ()=>{
        clearInterval(id.current)
      }
     }

     function useDebounceFn(f,delay){
      let ref = useRef()
      ref.current = f
      let id = useRef()
      let ret = useCallback((...args)=>{
        clearTimeout(id.current)
        id.current = setTimeout(()=>{
          ref.current(...args)
        },delay)
      },[delay])
      return ret
     }

      function Test(){
        let time = useTime()
        let pointPos = usePointPos()
        let name = InputCopyVModel()
        


        return (<div>
          {time}
          <hr />
          鼠标位置: {pointPos.x} , {pointPos.y}
          <hr />
          <input {...name} /> {name.value}
          </div>)
      }


      function MyApp() {
        let time = useTime()
        let countDown = useCountDown('2025-12-31 23:59:59')
        // let {data,error,loading} = useRequest(()=>{
        //   return fetch('https://jsonplaceholder.typicode.com/todos').then(res=>res.json())
        // })
        return  (<div>
          距离2025年结束还有 {countDown} 秒
          <hr />
          {'MayApp: ' + time}
          <Test />
          <hr />
          {
            // loading ? (<div>Loading...</div>) : data.map((todo,idx)=>{
            // return (<div key={idx}>
            //   <input type="checkbox" checked={todo.completed} onChange={()=>{}}/>
            //   <span>{todo.title}</span>
            //   </div>)
            // })
         }
          </div>)
      }
      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<Text />);
    </script>
    
  </body>
</html>